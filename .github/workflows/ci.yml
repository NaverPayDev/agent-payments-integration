name: CI

on:
    pull_request:
        branches:
            - '**'

jobs:
    ci:
        name: ğŸ§ª CI
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: ğŸ› ï¸ í™˜ê²½ ì„¤ì •
              uses: ./.github/actions/setup-env

            - name: ğŸ§ª CI ìˆ˜í–‰
              uses: ./.github/actions/run-ci

            - name: ğŸ“‹ Changeset ìƒíƒœ í™•ì¸
              if: github.event_name == 'pull_request'
              run: |
                  changeset_files=$(git diff --name-only origin/${{ github.event.pull_request.base.ref }}...HEAD -- '.changeset/*.md' | grep -v 'README.md' || true)

                  if [ -z "$changeset_files" ]; then
                    echo "âŒ changesetì´ í•„ìš”í•©ë‹ˆë‹¤!"
                    echo ""
                    echo "ğŸ”§ ë³€ê²½ì‚¬í•­ì´ ìˆëŠ” ê²½ìš°:"
                    echo "   pnpm changeset"
                    echo ""
                    echo "ğŸ”§ ë³€ê²½ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš° (ë¬¸ì„œ, ì„¤ì • ë“±):"
                    echo "   pnpm changeset --empty"
                    echo ""
                    echo "ğŸ’¡ Changesetì€ íŒ¨í‚¤ì§€ ë²„ì „ ê´€ë¦¬ì™€ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ìƒì„±ì— í•„ìš”í•©ë‹ˆë‹¤."
                    exit 1
                  else
                    echo "âœ… changeset í™•ì¸"
                    echo "$changeset_files" | sed 's/^/   - /'
                  fi
